<!DOCTYPE html>
<html>
    <head>
        <title>Pixel Art</title>
        <style>
            body {
                background-color: white;
            }

            #canvas {
                border: 1px solid #000000;
            }

            #controls {
                background-color: white;
            }

        </style>
    </head>
    <body>
        <div id = "menu">
            <label for="height">Height (between 1 and 250):</label>
            <input type="number" id="height" name="height" min="1" max="250" step = "1">
            <br>

            <label for="height">Width (between 1 and 250):</label>
            <input type="number" id="width" name="width" min="1" max="250" step = "1">
            <br>
            
            <label for = "bgColor">Background Color</label>
            <input type="color" id="bgColor" name="bgColor" value="#ff0000">
            <br>

            <button onclick="buildGrid()">Go!</button>
        </div>
        <div id = "main" style = "display: none;">
            <div id = "controls" style = "display: none;">
                <label for = "bgColor">Pencil Color</label>
                <input type="color" id="pencilColor" name="pencilColor" value="#000000">
                <br>

                <label for = "bgColor">Background Color</label>
                <input type="color" id="bgColor2" name="bgColor" value="#ff0000">
                <br>                
                <button onclick="reset()">Reset</button>
            </div>
            <br>
            <canvas id = "canvas" width="750" height="750"></canvas>
        </div>
       

        <script>
            heightNum = document.getElementById("height").value = 100;
            widthNum = document.getElementById("width").value = 100;
            
            document.getElementById("menu").style.display = "none";
            document.getElementById("main").style.display = "block";

            const canvas = document.getElementById("canvas");
            const ctx = canvas.getContext('2d');

            const viewportTransform = {
                x: 0,
                y: 0,
                scale: 1
            }

            const drawRect = (x, y, width, height, color) => {
                ctx.fillStyle = color
                ctx.fillRect(x, y, width, height)
            }

            let previousX = 0;
            let previousY = 0;
            const updatePanning = (e) => {
                const localX = e.clientX;
                const localY = e.clientY;

                viewportTransform.x += localX - previousX;
                viewportTransform.y += localY - previousY;

                previousX = localX;
                previousY = localY;
            }

            const updateZooming = (e) => {
                const oldScale = viewportTransform.scale;
                const oldX = viewportTransform.x;
                const oldY = viewportTransform.y;

                const localX = e.clientX;
                const localY = e.clientY;

                const previousScale = viewportTransform.scale;

                const newScale = viewportTransform.scale += e.deltaY * -0.01;

                const newX = localX - (localX - oldX) * (newScale/previousScale);
                const newY = localY - (localY - oldY) * (newScale/previousScale);

                viewportTransform.x = newX;
                viewportTransform.y = newY;
                viewportTransform.scale = newScale;
            }

            const onMouseMove = (e) => {
                updatePanning(e);
                render();
                console.log(e)
            }

            const onMouseWheel = (e) => {
                e.preventDefault()
                updateZooming(e)
                render()
                console.log(e)
            }

            canvas.addEventListener("mousedown", (e) => {
                previousX = e.clientX;
                previousY = e.clientY;

                canvas.addEventListener("mousemove", onMouseMove);
            })

            canvas.addEventListener("mouseup", (e) => {
                canvas.removeEventListener("mousemove", onMouseMove);
            })

            canvas.addEventListener("wheel", onMouseWheel, {passive: false});

            const render = () => {
                ctx.setTransform(1, 0, 0, 1, 0, 0);
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.setTransform(viewportTransform.scale, 0, 0, viewportTransform.scale, viewportTransform.x, viewportTransform.y);

                //background
                drawRect(0, 0, 750, 750, "lightgrey");
                //render grid
                for(let i = 0; i < 100; i++){
                    drawRect(i*7.5, i*7.5, 7.5, 7.5, "red");
                }
            }
            
            function reset(){
                document.getElementById("menu").style.display = "block";
                document.getElementById("main").style.display = "none";
            }

            render();
        </script>

    </body>
</html>